# CreditPilot 成功运行后的操作指南

**系统在 Railway 成功运行后，接下来该做什么？**

---

## ✅ 第一步：验证系统运行

### 1.1 基本验证

#### 检查服务状态
- [ ] Postgres 服务：绿色 "Running"
- [ ] Web 服务：绿色 "Running"
- [ ] Reminder-Cron 服务：绿色 "Running" 或 "Idle"

#### 测试 API 端点
1. **健康检查**：
   ```
   https://your-app.railway.app/health
   ```
   - 预期：返回 `{"status": "healthy"}`

2. **API 文档**：
   ```
   https://your-app.railway.app/docs
   ```
   - 预期：显示 Swagger UI 文档

3. **根路径**：
   ```
   https://your-app.railway.app/
   ```
   - 预期：返回 API 信息

---

### 1.2 数据库验证

在 Web 服务 Shell 中执行：
```bash
cd backend && python3 init_db.py
```

**预期结果**：
- ✅ 无错误
- ✅ 显示 "✅ 数据库表创建成功"
- ✅ 显示 "✅ 数据库初始化完成"

---

## 📥 第二步：导入初始数据

### 2.1 CSV 导入（推荐）

#### 准备 CSV 文件
1. 参考 `CSV导入说明.md`
2. 准备符合格式的 CSV 文件
3. 包含以下列：
   - 客户姓名
   - 卡号
   - 账单日期
   - 到期日
   - 等（参考 CSV 导入说明）

#### 通过 API 导入
1. 访问 API 文档：`https://your-app.railway.app/docs`
2. 找到 `POST /api/import/csv` 端点
3. 点击 "Try it out"
4. 上传 CSV 文件
5. 点击 "Execute"

**或使用 curl**：
```bash
curl -X POST "https://your-app.railway.app/api/import/csv" \
  -F "file=@your-file.csv"
```

---

### 2.2 手动添加数据

#### 通过 API 添加
1. 访问 API 文档
2. 使用相应的 API 端点添加数据
3. 例如：添加账单、交易记录等

---

## 📧 第三步：配置和测试邮件通知

### 3.1 验证邮件配置

#### 检查环境变量
- [ ] `SENDER_EMAIL` = `business@infinite-gz.com`
- [ ] `SENDER_PASSWORD` = `grqcgnrwqhbeocox`（Gmail 应用密码）
- [ ] `RECIPIENT_EMAIL` = `wang041396@gmail.com`
- [ ] `SMTP_SERVER` = `smtp.gmail.com`
- [ ] `SMTP_PORT` = `587`

#### 测试邮件发送
1. **等待 Cron 任务执行**（UTC 14:00，马来西亚时间 22:00）
2. **或手动触发**：
   - 进入 Reminder-Cron 服务
   - 手动触发一次部署
   - 查看日志确认邮件发送

3. **检查收件箱**：
   - 检查 `wang041396@gmail.com` 收件箱
   - 应该收到每日提醒邮件和 Excel 报告

---

## 📊 第四步：使用系统功能

### 4.1 上传账单 PDF

#### 通过 API 上传
1. 访问 API 文档
2. 找到 `POST /api/statements/upload` 端点
3. 上传 Alliance Bank PDF 账单
4. 系统会自动解析和分类

#### 通过 iPad App（如果已开发）
1. 使用 iPad App 上传账单
2. 系统自动处理

---

### 4.2 上传单据

#### 上传 Merchant Receipts
1. 访问 API 文档
2. 找到 `POST /api/documents/upload` 端点
3. 上传 Merchant Receipt 图片/PDF
4. 关联到相应的交易记录

#### 上传 Payment Slip
1. 上传付款凭证
2. 关联到相应的账单

#### 上传 Transfer Slip
1. 上传转账凭证
2. 关联到相应的交易

---

### 4.3 查看 Dashboard

#### 访问 Dashboard API
```
GET https://your-app.railway.app/api/dashboard/stats
```

**返回信息**：
- 总账单数
- 已验证账单数
- 总余额
- 即将到期的账单

---

### 4.4 查看每日提醒

#### 访问每日提醒 API
```
GET https://your-app.railway.app/api/reminders/daily-report
```

**返回信息**：
- 明天到期的账单
- 后天到期的账单
- 需要支付的金额
- Excel 报告下载链接

---

## 🔔 第五步：监控和维护

### 5.1 日常监控

#### 每日检查
- [ ] Web 服务正常运行
- [ ] Cron 任务正常执行（查看日志）
- [ ] 邮件正常发送（检查收件箱）
- [ ] 无错误日志

#### 每周检查
- [ ] 系统性能正常
- [ ] 数据库连接稳定
- [ ] Volume 存储空间充足
- [ ] API 响应时间正常

---

### 5.2 日志监控

#### 查看服务日志
1. **Web 服务日志**：
   - 进入 Web 服务 → Logs
   - 查看 API 请求和错误

2. **Cron 服务日志**：
   - 进入 Reminder-Cron 服务 → Logs
   - 查看定时任务执行情况

3. **Postgres 服务日志**：
   - 进入 Postgres 服务 → Logs
   - 查看数据库操作

---

### 5.3 性能监控

#### 监控指标
- API 响应时间
- 数据库查询性能
- 文件上传/下载速度
- 存储空间使用

#### Railway Metrics
- 进入服务 → Metrics
- 查看 CPU、内存使用情况
- 查看请求数量

---

## 🔧 第六步：维护操作

### 6.1 代码更新

#### 更新流程
1. **本地修改代码**
2. **测试本地运行**
3. **推送到 GitHub**：
   ```bash
   git add .
   git commit -m "更新说明"
   git push origin main
   ```
4. **Railway 自动部署**
5. **检查部署日志**
6. **验证功能正常**

---

### 6.2 环境变量更新

#### 更新步骤
1. 进入服务 → Variables
2. 修改变量值
3. 保存
4. 服务自动重启
5. 检查是否正常

#### 注意事项
- ⚠️ 修改 `DATABASE_URL` 要特别小心
- ⚠️ 修改后服务会重启，可能有短暂中断
- ⚠️ 建议在低峰期更新

---

### 6.3 数据库维护

#### 备份
- Railway Postgres 服务自动备份
- 也可以手动导出数据

#### 清理
- 定期清理旧数据（如果需要）
- 优化数据库查询
- 检查索引

---

### 6.4 Volume 维护

#### 清理文件
- 定期清理旧的上传文件
- 定期清理旧的报告文件
- 监控存储空间

#### 扩展存储
- 如果存储空间不足，考虑升级计划
- 或清理旧文件

---

## 📱 第七步：集成和使用

### 7.1 iPad App 集成（如果已开发）

#### 配置 API 端点
1. 在 iPad App 中配置 API 基础 URL：
   ```
   https://your-app.railway.app
   ```
2. 测试连接
3. 开始使用

---

### 7.2 小助理使用指南

#### 上传单据
1. 访问系统（通过 iPad App 或 Web）
2. 上传 Merchant Receipts
3. 上传 Payment Slips
4. 上传 Transfer Slips

#### 查看提醒
1. 每天 UTC 14:00（马来西亚时间 22:00）自动收到邮件
2. 邮件包含 Excel 报告
3. 查看需要处理的账单

---

## 🎯 第八步：优化和扩展

### 8.1 性能优化

#### 数据库优化
- 添加索引（如果需要）
- 优化查询
- 使用连接池（已配置）

#### API 优化
- 添加缓存（如果需要）
- 优化响应时间
- 限制请求频率（如果需要）

---

### 8.2 功能扩展

#### 可能的扩展
- 添加更多银行支持
- 添加更多报表功能
- 添加数据分析功能
- 添加通知功能

---

## ✅ 完成清单

### 系统运行
- [ ] 所有服务正常运行
- [ ] API 端点可访问
- [ ] 数据库连接正常

### 数据导入
- [ ] 初始数据已导入（如果需要）
- [ ] 测试数据已添加

### 邮件配置
- [ ] 邮件配置正确
- [ ] 测试邮件发送成功
- [ ] Cron 任务正常执行

### 系统使用
- [ ] 可以上传账单
- [ ] 可以上传单据
- [ ] 可以查看 Dashboard
- [ ] 可以查看提醒

### 监控维护
- [ ] 日志监控设置
- [ ] 性能监控设置
- [ ] 维护计划制定

---

## 🎉 恭喜！

如果以上所有步骤都完成，你的 CreditPilot 系统已经成功运行并可以使用了！

**下一步**：
- 开始使用系统管理信用卡账单
- 定期监控系统运行状态
- 根据需要优化和扩展功能

---

**指南完成时间**：2025-12-10
