# 📧 邮件自动发送功能说明

## ⚠️ 当前状态

**目前邮件功能还没有完全配置好，需要你完成配置才能自动发送。**

---

## 🎯 功能说明

系统支持**每天晚上10点自动发送邮件**到小助理的邮箱：**wang041396@gmail.com**

邮件内容包括：
- 📋 详细的提醒信息（明天和后天到期的账单）
- 📊 Excel日报附件（包含完整数据）

---

## ⚙️ 需要配置的步骤

### 第一步：创建 `.env` 配置文件

在项目目录创建配置文件：

```bash
cd /Users/1491-3913zee/Projects/CreditPilot/backend
```

创建 `.env` 文件，添加以下内容：

```env
# 邮件配置
SENDER_EMAIL=你的Gmail邮箱@gmail.com
SENDER_PASSWORD=你的应用专用密码（16位，去掉空格）
RECIPIENT_EMAIL=wang041396@gmail.com
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
```

**重要：**
- `SENDER_EMAIL`：你的Gmail邮箱（用来发送邮件）
- `SENDER_PASSWORD`：**不是你的Gmail登录密码**，而是"应用专用密码"（见下面说明）
- `RECIPIENT_EMAIL`：小助理的邮箱 **wang041396@gmail.com**

### 第二步：获取Gmail应用专用密码

Gmail需要"应用专用密码"才能发送邮件，普通密码不行。

**获取步骤：**

1. **登录你的Google账号**
2. **进入账号设置**
   - 访问：https://myaccount.google.com/
   - 点击左侧"安全性"
3. **开启两步验证**（如果还没开启）
   - 在"安全性"页面找到"两步验证"
   - 按照提示开启
4. **生成应用专用密码**
   - 在"两步验证"页面最下方
   - 找到"应用专用密码"
   - 点击"生成"
   - 选择"邮件"和"其他（自定义名称）"
   - 输入名称：`CreditPilot`
   - 点击"生成"
   - **复制生成的16位密码**（类似：`abcd efgh ijkl mnop`）
   - **去掉空格**，填入 `.env` 文件

### 第三步：测试邮件发送

配置完成后，测试一下：

```bash
cd /Users/1491-3913zee/Projects/CreditPilot/backend
source venv/bin/activate
python3 reminder_system.py
```

如果成功，会看到：
```
✓ Excel日报已生成: /path/to/report.xlsx
✓ 邮件已成功发送到: wang041396@gmail.com
```

检查邮箱，应该会收到测试邮件。

### 第四步：启动定时任务（每晚10点自动发送）

配置完成后，启动定时任务：

```bash
cd /Users/1491-3913zee/Projects/CreditPilot/backend
source venv/bin/activate
python3 -c "from reminder_system import setup_scheduler; setup_scheduler()"
```

这个命令会一直运行，**每天晚上10点**自动：
1. ✅ 生成提醒数据
2. ✅ 生成Excel日报
3. ✅ 发送邮件到 wang041396@gmail.com

---

## 📧 邮件内容示例

**邮件主题：** `CreditPilot 每日提醒 - 2025年01月27日`

**邮件正文：**
```
============================================================
📋 CreditPilot 每日到期提醒
============================================================

生成时间: 2025年01月27日 22:00

明天到期 (2 笔):

1️⃣ CHANG CHOON CHOW - HSBC *2058
   💰 GZ代付: RM 1,500.00 ⚠️ 待付款
   💰 Owner付款: RM 0.00 ✓ 已付
   📎 单据: 3/3 ✓

------------------------------------------------------------
总计需代付 (GZ): RM 2,300.00
总计需客户付 (Owner): RM 700.00
合计: RM 3,000.00

详细数据请查看附件Excel文件。
```

**附件：** `CreditPilot_Daily_Report_20250127.xlsx`

---

## ❓ 常见问题

### Q1: 现在会自动发送吗？

**A: 不会。** 需要先完成配置（创建 `.env` 文件，设置邮箱和密码），然后启动定时任务。

### Q2: 配置完成后，需要一直开着电脑吗？

**A: 是的。** 定时任务需要服务器一直运行。如果电脑关机了，就不会自动发送。

**解决方案：**
- 使用云服务器（24小时运行）
- 或者使用Mac的定时任务（cron）
- 或者每天早上手动运行一次提醒系统

### Q3: 可以测试发送吗？

**A: 可以！** 运行 `python3 reminder_system.py` 会立即发送一次测试邮件（不等到晚上10点）。

### Q4: 邮箱地址写错了怎么办？

**A: 修改 `.env` 文件中的 `RECIPIENT_EMAIL`**，改成正确的邮箱地址。

---

## ✅ 配置完成检查清单

- [ ] 已创建 `.env` 文件
- [ ] 已配置 `SENDER_EMAIL`（你的Gmail邮箱）
- [ ] 已配置 `SENDER_PASSWORD`（应用专用密码）
- [ ] 已配置 `RECIPIENT_EMAIL=wang041396@gmail.com`
- [ ] 已测试邮件发送成功
- [ ] 已收到测试邮件
- [ ] 已启动定时任务

---

## 🚀 快速配置模板

创建 `/Users/1491-3913zee/Projects/CreditPilot/backend/.env` 文件：

```env
# 邮件配置
SENDER_EMAIL=你的邮箱@gmail.com
SENDER_PASSWORD=你的16位应用专用密码（去掉空格）
RECIPIENT_EMAIL=wang041396@gmail.com
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
```

---

**配置完成后，系统就会每天晚上10点自动发送提醒邮件到 wang041396@gmail.com 了！** 📧✨
